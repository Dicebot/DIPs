# Remove `body` as a Keyword

| Field           | Value                                                           |
|-----------------|-----------------------------------------------------------------|
| DIP:            | 1003                                                            |
| Author:         | Jared Hanson                                                    |
| Implementation: |                                                                 |
| Status:         | Draft                                                           |

## Abstract

The word `body` is used in many day-to-day contexts that makes working around the
fact that it is a keyword in D tedious. Furthermore, this removal is very often
requested by various well known and lesser known D programmers. This DIP proposes that the
`body` keyword be removed and the word "body" be made available for use as the
name of a symbol. Various different methods are put forward for either replacing or
entirely removing the role `body` currently serves in D's contract programming syntax.

This proposal assumes basic knowledge of the terms "keyword" and "symbol" in
relation to D.

### Links

#### From the Spec
- [List of Keywords in D](http://dlang.org/spec/lex.html#Keyword)
- [Usage of the Body Keyword](http://dlang.org/spec/function.html#BodyStatement)
- [Usage of the Function Keyword](https://dlang.org/spec/expression.html#FunctionLiteral)

#### Forum Discussion
- [From 2011, on removing the body keyword](http://forum.dlang.org/thread/imdro4$286k$1@digitalmars.com)
- [From 2016, on the usage of body in user code](http://forum.dlang.org/thread/nyrosepldsxabewksehb@forum.dlang.org)
- [From 2016, anecdote of the word body used in an external C library ported to D](http://forum.dlang.org/post/lxdsvhygsaesjmkmavqp@forum.dlang.org)

## Description

The proposed changes to D are very simple, and are as follows:

1. Remove `body` as a keyword
2. Allow the usage of the word "body" as a symbol name.

There are several ways to accomplish this, listed in the table below:

Method of Implementation                                                                                                                                                              | Breakage    | Requires Deprecation Period?  | Recommended | Ease of User Code Adjustment | Simplicity of implementation | Comments
:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:------------|:------------------------------|:------------|:-----------------------------|:-----------------------------|:---------
1. Do not implement the suggested changes and do not allow `body` as a symbol name                                                                                                    | No          | No                            | No          | n/a                          | n/a                          |
2. Replace `body` with `function` in the next release of D                                                                                                                            | Yes         | No                            | No          | Difficult                    | Simple                       | Not feasible as it abruptly breaks user code with no warning
3. Remove `body` in the next release of D and disallow its use to denote the function body. Instead, accept an un-annotated block and allow `body` as a symbol name                   | Yes         | No                            | No          | Difficult                    | Simple                       | Not feasible as it abruptly breaks user code with no warning
4. Keep `body` as a conditional keyword and allow it as a sybol name in all other contexts                                                                                            | No          | No                            | Yes         | Easy                         | Complex                      | Conditional keywords are opposed by Walter Bright
5. Add `function` as an optional keyword in the place of `body` and schedule the `body` keyword for deprecation. After this period allow `body` as a symbol name                      | Yes         | Yes                           | Yes         | Moderate                     | Moderate                     |
6. Allow the function body to optionally be annotated with `body`, but do not require it. Schedule the `body` keyword for deprecation. After this period, allow body as a symbol name | Yes         | Yes                           | Yes         | Moderate                     | Moderate                     | Makes function contracts 1 line shorter
7. Schedule `body` for deprecation and then removal. After this period, add `function` in its place and allow `body` as a symbol name                                                 | Yes         | Yes                           | No          | Difficult                    | Moderate                     |
8. Schedule `body` for deprecation and then removal. After this period, disallow its use to denote the function body and allow `body` as a symbol name                                | Yes         | Yes                           | No          | Difficult                    | Moderate                     | Makes function contracts 1 line shorter

For option 2, the grammar will change as follows:
```
# This
BodyStatement:
    body BlockStatement

# Becomes this
BodyStatement:
    function BlockStatement
```

For option 3, the grammer will change as follows:
```
# This
BodyStatement:
    body BlockStatement

# Becomes this
BodyStatement:
    BlockStatement
```

For option 5, the grammar will change as follows:
```
# This
BodyStatement:
    body BlockStatement

# Becomes this
BodyStatement:
    body BlockStatement
    function BlockStatement
```

For option 6, the grammar will change as follows:
```
# This
BodyStatement:
    body BlockStatement

# Becomes this
BodyStatement:
    body BlockStatement
    BlockStatement
```

The grammar changes for options 7 and 8 are the same as for options 2 and 3.

### Rationale

Many D programmers complain about `body` being a keyword in D (see links section for relevant discussion). It is a commonly used
word in many different fields and as such, a programmer working in these fields will regularly come into contact with the
fact that it is a keyword (much to their annoyance). The `body` keyword in D does not "pull its weight"; D's contract programming
features are rarely used compared to how useful and desirable it is to be able to name a symbol "body". However, Even if D's
contract programming features _were_ heavily used, the author believes that it would not make up for the inconvenience caused by
`body` being a keyword. One of the reasons for this is that there is only **one** context in which body is used, compared to the
many different contexts in user code in which the word "body" may be used as a symbol name.

A partial list of the contexts in which the word `body` might be used as a symbol
name:

- In web programming where "body" is a required tag in any valid HTML document. Ex:
- It is a name commonly used for XML tags and/or attributes
- Physics simulations as well in astronomical contexts ("planetary bodyies", etc.)
- Video games, such as referring to the player character's body
- Working with HTTP requests and responses, which have a body
- Working programmatically with emails, which have a body
- Many external C and C++ libraries make use of "body" as a symbol name, making
  porting these to D and creating bindings for them more difficult
- Writing compilers and parsers (functions, loops, etc. all have bodies)
- Scripting interfaces and wrappers

#### Examples of Game Physics Library Code Ported to D That Use Body as a Symbol

- [Example 1](https://github.com/d-gamedev-team/dchip/blob/55f43e5f0cf67c8bc190711b69eb16230fa6188e/src/dchip/cpBody.d#L184)
- [Example 2](https://github.com/d-gamedev-team/dbox/blob/6f81fe065abec1e7def44fc777c5d8e9da936104/examples/demo/tests/bodytypes.d#L103)
- [Example 3](https://github.com/rcorre/chipmunkd/commit/d6bde5b649c70a53f4295f522e660fae3c1e740f)

The `body` keyword is not required from a parsing perspective; an un-annotated function block could be used
with no difficulties. Alternatively, the `function` keyword is readily available and has the same
meaning when used in the context of function contracts; it is very close in meaning to
the `body` keyword in this context. The `body` keyword is in fact shorthand for the term
"_function_ body", denoting the body of a function defintion that contains the actual code.
Therefore, these changes will not be any less descriptive of what the keyword means in
this context than the keyword `body`. It is anticipated that these changes may actually
lead to _less_ confusion for programmers that are new to D.

Also, the author believes that the `function` keyword is not as "overloaded" with different
meanings in different contexts, like with other keywords such as `static`. Therefore, these
proposed changes will not unduly "overload" the keyword `function`. There are currently 2
other contexts in which the `function` keyword is already used:

- Function variable type definitions
- Function literal definitions

Examples:
```D
int function(char c) fp; //Function variable type definition

fp = function int(char c) { return 6; }; //Function literal definition

int function() fp2 = function { return 0; }
```

If one considers that each keyword in a language entails a certain cost in terms of what names a
user may use as a symbol, as well as the fact that new users must learn what each keyword means,
then it follows that allowing `function` to be used in the context of function contracts has a much
"cheaper" tradeoff than using `body`. Therefore, it makes sense logically to remove the `body`
keyword, which has a high cost with a low return on investment, with the `function` keyword, which
also has a relatively high cost, but a much better return on investment.

### Breaking changes / deprecation process

Depending on how these changes are implemented, there will be little to no breakage,
and any breakage that _does_ occur will be done through the established deprecation
process for breaking changes (first a warning, then deprecation, then removal).

It is the author's opinion that option 4 is the ideal path forward for implementing this proposal and minimizing breakage. However, this
may not be feasible as it requires the implementation of conditional keywords and the effort to implement them is currently unknown. Likewise,
option 7 and option 8 are not recommended as while they minimize code breakage within user code, they do not allow users to adjust their code
until _after_ `body` has been removed as a keyword.

As it may not be feasible to implement conditional keywords for this proposal, the recommended options are option 5 and option 6, which are
"middle of the road" approaches. The `body` keyword will be deprecated. Users will be warned well in advance and may update their code well
before the deprecation and removal stages take place.

### Examples

How "body" might be used as a variable name in DOM-based code:
```D
document.body.addEventListener("click"), (Event ev) { //Error, body is a keyword
    ev.target.appendText("got click!");
    ev.preventDefault();
});
```

How "body" is currently used in physics simulation code:
```D
void cpBodyActivateStatic(cpBody* body_, cpShape* filter)
{
    cpAssertHard(cpBodyIsStatic(body_), "cpBodyActivateStatic() called on a non-static body_.");

    mixin(CP_BODY_FOREACH_ARBITER!("body_", "arb", q{
        if (!filter || filter == arb.a || filter == arb.b)
        {
            cpBodyActivate(arb.body_a == body_ ? arb.body_b : arb.body_a);
        }
    }));
}
```

Examples of how code will change with this proposal:
```D
//Current-day D
int div(int a, int b)
in { assert(b != 0); }
body
{
    return a / b;
}

//Option 5
int div(int a, int b)
in { assert(b != 0); }
function
{
    return a / b;
}

//Option 6
int div(int a, int b)
in { assert(b != 0); }
{
    return a / b;
}

auto div = function(int a, int b) in { assert(b != 0); } body { return a / b; };

//Option 5
auto div = function(int a, int b) in { assert(b != 0); } function { return a / b; };

//Option 6
auto div = function(int a, int b) in { assert(b != 0); } { return a / b; };
```

## Copyright & License

Copyright (c) 2016 by the D Language Foundation

Licensed under [Creative Commons Zero 1.0](https://creativecommons.org/publicdomain/zero/1.0/legalcode.txt)

### Reviews