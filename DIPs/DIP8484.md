# Traits omniscience

| Field           | Value                                                           |
|-----------------|-----------------------------------------------------------------|
| DIP:            | 8484                                                            |
| Author:         | Basile Burg                                                     |
| Implementation: |                                                                 |
| Status:         | Draft                                                           |

## Abstract

The results of `__traits()` are limited by the protection attributes.

This DIP proposes to remove the limitation from all the traits, except `allMembers` that will get a new parameter allowing it to be omniscient.

### Links

- https://forum.dlang.org/thread/nq512d$9po$1@digitalmars.com
- https://issues.dlang.org/show_bug.cgi?id=15335
- https://issues.dlang.org/show_bug.cgi?id=15371

## Description

### New trait parameter

A second optional trait parameter, a `bool` will be added to the trait `allMembers`.

`__traits(allMember, Parent, false)` will be strictly the same as `__traits(allMember, Parent)`. 
`__traits(allMember, Parent, true)` will toggle omnisciency on and each member of `Parent`, wether it would be accessible or not in a standard statement, will be in the resulting tuple.

It's also worth mentioning that `getProtection` can be used to stay compliant with the protection attributes, despite of the super visual acuity obtained when the new parameter is set to `true`.

### Changes applied to the existing traits

The new `allMembers` parameter only allows to get the identifiers of the protected members. To make the results usable, the protection checks must be removed from each particular trait, including:

- `getMember`
- `getOverloads`
- `derivedMembers`
- (TODO: complete the list)

It doesn't matter if they see everything because `allMembers` without the new default parameter acts as a filter.

### Rationale

#### History of protection attributes

Protection attributes such as `private` and `public` appeared with the Object Oriented Programming paradigm (added to Simula in 1987). Applied to the traits, they limit the creativity since D is a multi paradigm language. Template Meta Programming is particularly affected by the limitation.

#### Library traits

The problem was [detected for the first time](https://issues.dlang.org/show_bug.cgi?id=15335) shortly after the phobos additions `hasUDA` `getUDAs` and `getSymbolsByUDA`.
The languages traits could be used to implement easily more library traits. However the protection attributes would make them unusable in many scenario.

### Breaking changes / deprecation process

No breaking changes. Any existing code using `__traits(allMember, Stuff)` will behave like with `__traits(allMember, Stuff, false)`, which respects the protection attributes.

### Examples

```D
module thing;

struct A
{
   private int _field;
   int value;
}
```

```D
module stuff;

import std.stdio, thing;

void omniscient()
{
   foreach(member; __traits(allMembers, thing.A, true))
      write(member, " "); // _field value
}

void implicitProtectionCompliance()
{
   foreach(member; __traits(allMembers, thing.A))
      write(member, " "); // value
}

void explicitProtectionCompliance()
{
   foreach(member; __traits(allMembers, thing.A, false))
      write(member, " "); // value
}
```

## Copyright & License

Copyright (c) 2016 by the D Language Foundation

Licensed under [Creative Commons Zero 1.0](https://creativecommons.org/publicdomain/zero/1.0/legalcode.txt)

### Reviews
